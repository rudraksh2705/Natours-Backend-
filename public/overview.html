<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Natours | Exciting tours for adventurous people</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="shortcut icon" type="image/png" href="img/favicon.png">
    <link href="https://fonts.googleapis.com/css?family=Lato:300,300i,700" rel="stylesheet">
</head>
<body>
    <header class="header">
        <nav class="nav nav--tours">
            <a class="nav__el" href="#">All tours</a>
        </nav>
        <div class="header__logo">
            <img src="img/logo-white.png" alt="Natours logo">
        </div>
        <nav class="nav nav--user">
            <button class="nav__el">Log In</button>
            <button class="nav__el nav__el--cta">Sign Up</button>
        </nav>
    </header>

    <main class="main">
        <div class="card-container" id="tours-container">
            <!-- Tours will be dynamically loaded here -->
            <div class="loading-message">Loading tours...</div>
        </div>
    </main>

    <footer class="footer">
        <div class="footer__logo">
            <img src="img/logo-green.png" alt="Natours Logo">
        </div>
        <ul class="footer__nav">
            <li><a href="#">About us</a></li>
            <li><a href="#">Download apps</a></li>
            <li><a href="#">Become a guide</a></li>
            <li><a href="#">Careers</a></li>
            <li><a href="#">Contact</a></li>
        </ul>
        <p class="footer__copyright">Â© by Jonas Schmedtmann</p>
    </footer>

    <script>
        // Function to format date
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleString('en-us', {month: 'long', year: 'numeric'});
        }

        // Function to create tour card HTML
        function createTourCard(tour) {
            return `
                <div class="card">
                    <div class="card__header">
                        <div class="card__picture">
                            <div class="card__picture-overlay">&nbsp;</div>
                            <img class="card__picture-img" src="img/tours/${tour.imageCover}" alt="${tour.name}">
                        </div>
                        <h3 class="heading-tertirary">
                            <span>${tour.name}</span>
                        </h3>
                    </div>
                    <div class="card__details">
                        <h4 class="card__sub-heading">${tour.difficulty} ${tour.duration}-day tour</h4>
                        <p class="card__text">${tour.summary}</p>
                        <div class="card__data">
                            <svg class="card__icon">
                                <use xlink:href="img/icons.svg#icon-map-pin"></use>
                            </svg>
                            <span>${tour.startLocation.description}</span>
                        </div>
                        <div class="card__data">
                            <svg class="card__icon">
                                <use xlink:href="img/icons.svg#icon-calendar"></use>
                            </svg>
                            <span>${formatDate(tour.startDates[0])}</span>
                        </div>
                        <div class="card__data">
                            <svg class="card__icon">
                                <use xlink:href="img/icons.svg#icon-flag"></use>
                            </svg>
                            <span>${tour.locations.length} stops</span>
                        </div>
                        <div class="card__data">
                            <svg class="card__icon">
                                <use xlink:href="img/icons.svg#icon-user"></use>
                            </svg>
                            <span>${tour.maxGroupSize} people</span>
                        </div>
                    </div>
                    <div class="card__footer">
                        <p>
                            <span class="card__footer-value">$${tour.price}</span>
                            <span class="card__footer-text">per person</span>
                        </p>
                        <p class="card__ratings">
                            <span class="card__footer-value">${tour.ratingsAverage}</span>
                            <span class="card__footer-text">rating (${tour.ratingsQuantity})</span>
                        </p>
                        <a class="btn btn--green btn--small" href="tour.html?slug=${tour.slug}">Details</a>
                    </div>
                </div>
            `;
        }

        // Function to load tours from API
        async function loadTours() {
            try {
                const response = await fetch('/api/v1/tours/public');
                if (!response.ok) {
                    throw new Error('Failed to fetch tours');
                }
                const tours = await response.json();
                
                const container = document.getElementById('tours-container');
                container.innerHTML = '';
                
                if (tours.data && tours.data.length > 0) {
                    tours.data.forEach(tour => {
                        container.innerHTML += createTourCard(tour);
                    });
                } else {
                    container.innerHTML = '<div class="error-message">No tours available at the moment.</div>';
                }
            } catch (error) {
                console.error('Error loading tours:', error);
                document.getElementById('tours-container').innerHTML = 
                    '<div class="error-message">Failed to load tours. Please try again later.</div>';
            }
        }

        // Load tours when page loads
        document.addEventListener('DOMContentLoaded', loadTours);
    </script>
</body>
</html>